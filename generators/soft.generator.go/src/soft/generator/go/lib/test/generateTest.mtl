[comment encoding = UTF-8 /]
[module generateTest('http://www.eclipse.org/emf/2002/Ecore')/]

[import soft::generator::go::lib::generateCommon/]
[import soft::generator::go::generateCommon/]
[import soft::generator::common::generateCommon/]
[import soft::generator::go::lib::test::generateType/]

[template public generateTest(aClass : EClass) { implementationName : String = aClass.getImplementationName(); aPackage : EPackage = aClass.ePackage } ]
[file (aClass.ePackage.getOutputDirectory() + '/' + aClass.getImplementationTestFileName( aClass.name ), false, 'UTF-8')]
[fileComment()/]

package [aPackage.name/]

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func [implementationName/]Test(t *testing.T) {
	[aClass.eStructuralFeatures.generateTestImplementation(aClass)/]
}
[/file]
[/template]

[template private generateTestImplementation(aStructuralFeature : EStructuralFeature, aClass : EClass)]
[if isGet() and isField() ]
	[aStructuralFeature.generateGetTestImplementation(aClass)/]
[/if]
[if isBasicGet()]
[/if]
[if isSet()]
[/if]
[if isBasicSet()]
[/if]
[if isUnSet()]
[/if]
[if isBasicUnSet()]
[/if]
[/template]

[template private generateGetTestImplementation(aStructuralFeature : EStructuralFeature, aClass : EClass)]
[let varName : String = aStructuralFeature.getVariableName() ]
{
	obj := new[aClass.getImplementationName().toUpperFirst()/]()
	obj.[varName/] = [aStructuralFeature.eType.getTestValue()/]
	assert.Equal(t, [aStructuralFeature.eType.getTestValue()/], obj.[varName/])
}
[/let]
[/template]